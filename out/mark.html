<!DOCTYPE html>
<html>
    <head id='head'>
        <meta http-equiv='Content-Type' content='text/html; charset=UTF-8'>
        <script>if(document.location.protocol == 'http:')document.location.protocol = 'https';</script>
        <script src='./static/jquery/build/jquery.min.js'></script>
        <script src='./static/marked/marked.min.js'></script>
    </head>
    <body>
        <div id="mark"></div>
        <div id="disqus_thread"></div>
        <script>
            $.getJSON('./config.json')
            .done(function(config){
                var name = document.location.search.substring(1);
                config.name = (name.indexOf('/')<0)?name:config.name;
                $('#head').append($('<title>').text(decodeURI(config.name)));
                $.each(config.style, function(_, link){
                    $('#head').append($('<link>').attr({
                        "rel":"stylesheet",
                        "type":"text/css",
                        "href":link
                    }));
                });
                $.get(['.', config.mark, config.name+'.md'].join('/'))
                .success(function(text){
                    $('#mark').append(marked(text));
                    var disqus_shortname = config.disqus;

                    (function() {{
                        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                    }})();
                })
                .fail(function(){$('#mark').append(marked("# ( ・_・)"))});
            })
            .fail(function(){$('#mark').append(marked("# ( ・_・)"))});
        </script>
    </body>
</html>
